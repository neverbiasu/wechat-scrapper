# 微信公众号爬虫工具 - 模块设计文档

## 1. 引言

### 1.1. 目的

本文档旨在概述微信公众号爬虫工具的功能模块，阐述其设计理念、功能职责、协作流程以及最佳实践，为开发者提供清晰的模块划分和设计指导。

### 1.2. 范围

本文档涵盖以下内容：

*   核心功能模块的功能概述
*   模块间的协作流程
*   典型使用场景示例
*   最佳实践建议
*   详细的模块拆分方案（模块职责、核心类/函数、依赖关系、优先级）

### 1.3. 读者对象

本文档主要面向以下读者：

*   项目开发者
*   系统架构师
*   测试人员
*   对微信公众号爬虫工具有兴趣的潜在用户

## 2. 功能模块概述

### 2.1. 核心功能模块

#### 2.1.1. 认证模块 (Authentication)

*   **职责**：处理用户登录凭据，确保能够安全访问微信公众号内容。
*   **主要功能**：
    *   管理微信公众平台的认证信息（Cookie 和 Token）。
    *   处理验证请求，引导用户完成验证流程。
    *   支持通过配置文件保存和加载认证信息，方便重复使用。
*   **详细文档**：[./modules/authentication.md](./modules/authentication.md)

#### 2.1.2. 下载模块 (Downloader)

*   **职责**：负责微信公众号文章的下载和保存。
*   **主要功能**：
    *   下载单篇微信公众号文章。
    *   批量下载指定公众号的所有文章。
    *   支持多种下载模式，可控制资源（图片、视频等）的下载。
    *   具备智能限速功能，避免触发微信平台的反爬虫机制。
*   **详细文档**：[./modules/downloader.md](./modules/downloader.md)

#### 2.1.3. 格式转换模块 (Converter)

*   **职责**：支持将下载的文章保存为多种格式，以满足不同的使用需求。
*   **主要功能**：
    *   保存为 HTML 格式，完整保留原文的排版和样式。
    *   保存为 PDF 格式，便于分享和打印。
    *   保存为 Markdown 格式，便于编辑和内容再利用。
*   **详细文档**：[./modules/converter.md](./modules/converter.md)

#### 2.1.4. 用户界面模块 (User Interface)

*   **职责**：提供多种与工具交互的方式，满足不同用户的偏好。
*   **主要功能**：
    *   **命令行界面 (CLI)**：支持完整的参数控制和自动化操作。
    *   **图形用户界面 (GUI)**：提供直观的操作方式（如果实现）。
    *   **配置文件管理**：简化重复操作，提高效率。
*   **详细文档**：[./modules/interface.md](./modules/interface.md)

### 2.2. 功能协作流程

1.  **认证阶段**：使用认证模块设置或加载微信公众平台访问凭据。
2.  **下载阶段**：通过下载模块获取文章内容和相关资源。
3.  **格式转换阶段**：根据用户选择的格式，将文章转换为 HTML、PDF 或 Markdown。
4.  **保存管理阶段**：将转换后的内容保存到指定目录，便于后续查看和使用。

## 3. 典型使用场景示例

### 3.1. 场景一：保存重要参考文章

1.  复制目标文章的 URL。
2.  使用下载模块的单篇文章下载功能，指定 URL。
3.  选择保存为 PDF 格式。
4.  工具将文章及其相关资源保存到指定目录。

### 3.2. 场景二：归档整个行业公众号

1.  准备目标公众号的昵称。
2.  使用批量下载功能，指定公众号昵称。
3.  选择 HTML 格式，以保留完整的原文样式。
4.  工具自动下载所有可获取的历史文章。

### 3.3. 场景三：提取公众号内容进行编辑

1.  使用批量下载功能获取目标公众号的文章。
2.  选择 Markdown 格式。
3.  使用 Markdown 编辑器打开生成的文件，进行编辑和整合。

## 4. 最佳实践

### 4.1. 认证信息管理

*   使用配置文件存储认证信息，避免重复手动输入。
*   定期更新认证信息，因为微信平台的 Cookie 通常会在几天内过期。

### 4.2. 下载设置优化

*   下载大量文章时，适当增加延迟参数，以降低被反爬虫机制限制的风险。
*   首次使用时，先测试少量文章，确认各项设置正确。

### 4.3. 格式选择技巧

*   重要参考资料选择 PDF 格式，便于永久保存和分享。
*   需要保留完整样式选择 HTML 格式。
*   需要进一步编辑选择 Markdown 格式。

### 4.4. 目录管理

*   为不同的公众号设置单独的输出目录，避免混淆。
*   使用有意义的文件夹名称，便于后续查找和管理。

## 5. 模块拆分方案

### 5.1. 模块划分表格

| 模块名称          | 主要职责       | 核心类/函数                 | 依赖模块                      | 优先级 |
| :---------------- | :------------- | :-------------------------- | :---------------------------- | :----- |
| **auth**          | 处理认证与登录 | `WechatAuth`                | -                             | 高     |
| **anti\_crawler** | 反爬虫策略     | `AntiCrawlerHandler`        | -                             | 高     |
| **account**       | 公众号信息获取 | `WechatAccount`             | auth, anti\_crawler           | 中     |
| **articles**      | 文章信息获取   | `WechatArticles`            | auth, anti\_crawler           | 高     |
| **downloader**    | 下载功能实现   | `WechatDownloader`          | auth, anti\_crawler, articles | 高     |
| **converter**     | 格式转换功能   | `Html2Pdf`, `Html2Markdown` | -                             | 中     |
| **utils**         | 通用工具函数   | 各种辅助函数                | -                             | 中     |
| **ui/cli**        | 命令行界面     | `main()`                    | 所有核心模块                  | 中     |
| **ui/gui**        | 图形用户界面   | `WechatGUI`                 | 所有核心模块                  | 低     |
| **config**        | 配置管理       | `Config`                    | -                             | 低     |
| **app**           | 应用协调       | `WechatScrapperApp`         | 所有模块                      | 中     |

### 5.2. 模块职责详细说明

1.  **auth**: 提供登录微信公众平台的功能，处理 Cookie 和 Token 的获取、验证和刷新。
2.  **anti\_crawler**: 实现反爬机制的应对策略，包括延迟处理、验证处理、请求头管理等。
3.  **account**: 获取公众号基本信息，如 Biz ID 等。
4.  **articles**: 获取、解析文章列表和文章详情信息。
5.  **downloader**: 实现单篇和批量下载，处理重试、断点续传等逻辑。
6.  **converter**: 将 HTML 转换为 PDF、Markdown 等格式。
7.  **utils**: 提供文件名处理、网络请求、时间戳转换等通用功能。
8.  **ui/cli**: 命令行交互接口。
9.  **ui/gui**: 图形用户界面（如果实现）。
10. **config**: 配置文件的读写和管理。
11. **app**: 整合各模块，提供统一的应用入口。

### 5.3. 模块间交互图

（此处应包含模块间交互的示意图，例如 UML 组件图或流程图，描述模块之间的依赖关系和调用顺序。）

## 6. 术语表

| 术语       | 解释                                                             |
| :--------- | :--------------------------------------------------------------- |
| Cookie     | 用于验证用户身份的 HTTP Cookie，从微信公众平台获取。             |
| Token      | 微信公众平台用于验证用户身份的令牌。                             |
| Biz ID     | 微信公众号的唯一标识符。                                         |
| 反爬虫机制 | 微信公众平台用于阻止恶意爬虫的技术手段，例如频率限制、验证码等。 |

## 7. 未来展望

*   **更智能的反爬虫策略**：根据微信平台的反爬虫机制变化，动态调整应对策略。
*   **更丰富的文件格式支持**：支持更多的文章保存格式，例如 EPUB、TXT 等。
*   **更强大的用户界面**：提供更友好的用户界面，简化操作流程。
*   **云端存储与同步**：支持将下载的文章存储到云端，并实现多设备同步。
